
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>napari.plugins._plugin_manager &#8212; napari</title>
    
    <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
    <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/logo.png" class="logo" alt="logo">
</a>


    
    <!-- A small template snippet for theme testing -->
<b>napari</b>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../usage.html">
  Usage
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../plugins/index.html">
  Plugins
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../community/index.html">
  Community
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../api/index.html">
  API Reference
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://napari-hub.org">napari hub<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/napari/napari" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for napari.plugins._plugin_manager</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">FunctionType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

<span class="kn">from</span> <span class="nn">napari_plugin_engine</span> <span class="kn">import</span> <span class="n">HookImplementation</span>
<span class="kn">from</span> <span class="nn">napari_plugin_engine</span> <span class="kn">import</span> <span class="n">PluginManager</span> <span class="k">as</span> <span class="n">PluginManager</span>
<span class="kn">from</span> <span class="nn">napari_plugin_engine.hooks</span> <span class="kn">import</span> <span class="n">HookCaller</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="kn">from</span> <span class="nn">..settings</span> <span class="kn">import</span> <span class="n">get_settings</span>
<span class="kn">from</span> <span class="nn">..types</span> <span class="kn">import</span> <span class="n">AugmentedWidget</span><span class="p">,</span> <span class="n">LayerData</span><span class="p">,</span> <span class="n">SampleDict</span><span class="p">,</span> <span class="n">WidgetCallable</span>
<span class="kn">from</span> <span class="nn">..utils._appdirs</span> <span class="kn">import</span> <span class="n">user_site_packages</span>
<span class="kn">from</span> <span class="nn">..utils.events</span> <span class="kn">import</span> <span class="n">EmitterGroup</span><span class="p">,</span> <span class="n">EventedSet</span>
<span class="kn">from</span> <span class="nn">..utils.misc</span> <span class="kn">import</span> <span class="n">camel_to_spaces</span><span class="p">,</span> <span class="n">running_as_bundled_app</span>
<span class="kn">from</span> <span class="nn">..utils.theme</span> <span class="kn">import</span> <span class="n">Theme</span><span class="p">,</span> <span class="n">register_theme</span><span class="p">,</span> <span class="n">unregister_theme</span>
<span class="kn">from</span> <span class="nn">..utils.translations</span> <span class="kn">import</span> <span class="n">trans</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_builtins</span><span class="p">,</span> <span class="n">hook_specifications</span>


<span class="k">class</span> <span class="nc">PluginHookOption</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom type specifying plugin and enabled state.&quot;&quot;&quot;</span>

    <span class="n">plugin</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span>


<span class="n">CallOrderDict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">PluginHookOption</span><span class="p">]]</span>


<div class="viewcode-block" id="NapariPluginManager"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager">[docs]</a><span class="k">class</span> <span class="nc">NapariPluginManager</span><span class="p">(</span><span class="n">PluginManager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;PluginManager subclass for napari-specific functionality.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The events emitted by the plugin include:</span>

<span class="sd">    * registered (value: str)</span>
<span class="sd">        Emitted after plugin named `value` has been registered.</span>
<span class="sd">    * unregistered (value: str)</span>
<span class="sd">        Emitted after plugin named `value` has been unregistered.</span>
<span class="sd">    * enabled (value: str)</span>
<span class="sd">        Emitted after plugin named `value` has been removed from the block list.</span>
<span class="sd">    * disabled (value: str)</span>
<span class="sd">        Emitted after plugin named `value` has been added to the block list.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ENTRY_POINT</span> <span class="o">=</span> <span class="s1">&#39;napari.plugin&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;napari&#39;</span><span class="p">,</span> <span class="n">discover_entry_point</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ENTRY_POINT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">EmitterGroup</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">registered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">unregistered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">enabled</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blocked</span><span class="p">:</span> <span class="n">EventedSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">EventedSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blocked</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_blocked_change</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_blocked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_hookspecs</span><span class="p">(</span><span class="n">hook_specifications</span><span class="p">)</span>

        <span class="c1"># dicts to store maps from extension -&gt; plugin_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extension2reader</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extension2writer</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SampleDict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">WidgetCallable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function_widgets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Theme</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">running_as_bundled_app</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_site_packages</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_blocked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_builtins</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;builtins&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="s2">&quot;skimage&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_skimage_data</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_skimage_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;scikit-image&#39;</span><span class="p">)</span>

            <span class="kn">from</span> <span class="nn">..settings</span> <span class="kn">import</span> <span class="n">get_settings</span>

            <span class="c1"># dicts to store maps from extension -&gt; plugin_name</span>
            <span class="n">plugin_settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">()</span><span class="o">.</span><span class="n">plugins</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extension2reader</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plugin_settings</span><span class="o">.</span><span class="n">extension2reader</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extension2writer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plugin_settings</span><span class="o">.</span><span class="n">extension2writer</span><span class="p">)</span>

<div class="viewcode-block" id="NapariPluginManager.register"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">registered</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span></div>

<div class="viewcode-block" id="NapariPluginManager.unregister"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.unregister">[docs]</a>    <span class="k">def</span> <span class="nf">unregister</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name_or_object</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_object</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="n">name_or_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">name_or_object</span><span class="p">)</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">name_or_object</span><span class="p">)</span>

        <span class="c1"># unregister any theme that was associated with the</span>
        <span class="c1"># unregistered plugin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unregister_theme_colors</span><span class="p">(</span><span class="n">_name</span><span class="p">)</span>

        <span class="c1"># remove widgets, sample data, theme data</span>
        <span class="k">for</span> <span class="n">_dict</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_function_widgets</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">unregistered</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plugin</span></div>

    <span class="k">def</span> <span class="nf">_on_blocked_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># things that are &quot;added to the blocked list&quot; become disabled</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">added</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">disabled</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># things that are &quot;removed from the blocked list&quot; become enabled</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">removed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">enabled</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">removed</span><span class="p">:</span>
            <span class="c1"># if an event was removed from the &quot;disabled&quot; list...</span>
            <span class="c1"># let&#39;s reregister.  # TODO: might be able to be more direct here.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">discover</span><span class="p">()</span>

        <span class="n">get_settings</span><span class="p">()</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">disabled_plugins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_blocked</span><span class="p">)</span>

<div class="viewcode-block" id="NapariPluginManager.call_order"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.call_order">[docs]</a>    <span class="k">def</span> <span class="nf">call_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_result_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallOrderDict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the call order from the plugin manager.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        call_order : CallOrderDict</span>
<span class="sd">            mapping of hook_specification name, to a list of dicts with keys:</span>
<span class="sd">            {&#39;plugin&#39;, &#39;enabled&#39;}.  Plugins earlier in the dict are called</span>
<span class="sd">            sooner.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">order</span><span class="p">:</span> <span class="n">CallOrderDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">caller</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># no need to save call order unless we only use first result</span>
            <span class="k">if</span> <span class="n">first_result_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">caller</span><span class="o">.</span><span class="n">is_firstresult</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">impls</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">get_hookimpls</span><span class="p">()</span>
            <span class="c1"># no need to save call order if there is only a single item</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">impls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">order</span><span class="p">[</span><span class="n">spec_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s1">&#39;plugin&#39;</span><span class="p">:</span> <span class="n">impl</span><span class="o">.</span><span class="n">plugin_name</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="n">impl</span><span class="o">.</span><span class="n">enabled</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">impl</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">impls</span><span class="p">)</span>
                <span class="p">]</span>
        <span class="k">return</span> <span class="n">order</span></div>

<div class="viewcode-block" id="NapariPluginManager.set_call_order"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.set_call_order">[docs]</a>    <span class="k">def</span> <span class="nf">set_call_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_order</span><span class="p">:</span> <span class="n">CallOrderDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the plugin manager call order to match settings plugin values.</span>

<span class="sd">        Note: Run this after load_settings_plugin_defaults, which</span>
<span class="sd">        sets the default values in settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_order : CallOrderDict</span>
<span class="sd">            mapping of hook_specification name, to a list of dicts with keys:</span>
<span class="sd">            {&#39;plugin&#39;, &#39;enabled&#39;}.  Plugins earlier in the dict are called</span>
<span class="sd">            sooner.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">spec_name</span><span class="p">,</span> <span class="n">hook_caller</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">spec_name</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">new_order</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">spec_name</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># the plugin may not be there if its been disabled.</span>
                        <span class="n">hook_caller</span><span class="o">.</span><span class="n">_set_plugin_enabled</span><span class="p">(</span>
                            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">order</span><span class="p">:</span>
                    <span class="n">hook_caller</span><span class="o">.</span><span class="n">bring_to_front</span><span class="p">(</span><span class="n">order</span><span class="p">)</span></div>

    <span class="c1"># SAMPLE DATA ---------------------------</span>

<div class="viewcode-block" id="NapariPluginManager.register_sample_data"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.register_sample_data">[docs]</a>    <span class="k">def</span> <span class="nf">register_sample_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">LayerData</span><span class="p">]]]],</span>
        <span class="n">hookimpl</span><span class="p">:</span> <span class="n">HookImplementation</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register sample data dict returned by `napari_provide_sample_data`.</span>

<span class="sd">        Each key in `data` is a `sample_name` (the string that will appear in the</span>
<span class="sd">        `Open Sample` menu), and the value is either a string, or a callable that</span>
<span class="sd">        returns an iterable of ``LayerData`` tuples, where each tuple is a 1-, 2-,</span>
<span class="sd">        or 3-tuple of ``(data,)``, ``(data, meta)``, or ``(data, meta,</span>
<span class="sd">        layer_type)``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : Dict[str, Union[str, Callable[..., Iterable[LayerData]]]]</span>
<span class="sd">            A mapping of {sample_name-&gt;data}</span>
<span class="sd">        hookimpl : HookImplementation</span>
<span class="sd">            The hook implementation that returned the dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plugin_name</span> <span class="o">=</span> <span class="n">hookimpl</span><span class="o">.</span><span class="n">plugin_name</span>
        <span class="n">hook_name</span> <span class="o">=</span> <span class="s1">&#39;napari_provide_sample_data&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provided a non-dict object to </span><span class="si">{hook_name!r}</span><span class="s1">: data ignored.&#39;</span><span class="p">,</span>
                <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SampleDict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_datum</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_datum</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">datum</span><span class="p">:</span> <span class="n">SampleDict</span> <span class="o">=</span> <span class="n">_datum</span>
                <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_datum</span> <span class="ow">or</span> <span class="s1">&#39;display_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_datum</span><span class="p">:</span>
                    <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                        <span class="s1">&#39;In </span><span class="si">{hook_name!r}</span><span class="s1">, plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provided an invalid dict object for key </span><span class="si">{name!r}</span><span class="s1"> that does not have required keys: &quot;data&quot; and &quot;display_name&quot;. Ignoring&#39;</span><span class="p">,</span>
                        <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
                        <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datum</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">_datum</span><span class="p">,</span> <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">callable</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
                <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span>
            <span class="p">):</span>
                <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provided invalid data for key </span><span class="si">{name!r}</span><span class="s1"> in the dict returned by </span><span class="si">{hook_name!r}</span><span class="s1">. (Must be str, callable, or dict), got (</span><span class="si">{dtype}</span><span class="s1">).&#39;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]),</span>
                <span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">datum</span>

        <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_data</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_data</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="NapariPluginManager.available_samples"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.available_samples">[docs]</a>    <span class="k">def</span> <span class="nf">available_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a tuple of sample data keys provided by plugins.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sample_keys : Tuple[Tuple[str, str], ...]</span>
<span class="sd">            A sequence of 2-tuples ``(plugin_name, sample_name)`` showing available</span>
<span class="sd">            sample data provided by plugins.  To load sample data into the viewer,</span>
<span class="sd">            use :meth:`napari.Viewer.open_sample`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from napari.plugins import available_samples</span>

<span class="sd">            sample_keys = available_samples()</span>
<span class="sd">            if sample_keys:</span>
<span class="sd">                # load first available sample</span>
<span class="sd">                viewer.open_sample(*sample_keys[0])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_data</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_data</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
        <span class="p">)</span></div>

    <span class="c1"># THEME DATA ------------------------------------</span>

<div class="viewcode-block" id="NapariPluginManager.register_theme_colors"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.register_theme_colors">[docs]</a>    <span class="k">def</span> <span class="nf">register_theme_colors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">]]],</span>
        <span class="n">hookimpl</span><span class="p">:</span> <span class="n">HookImplementation</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register theme data dict returned by `napari_experimental_provide_theme`.</span>

<span class="sd">        The `theme` data should be provided as an iterable containing dictionary</span>
<span class="sd">        of values, where the ``folder`` value will be used as theme name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plugin_name</span> <span class="o">=</span> <span class="n">hookimpl</span><span class="o">.</span><span class="n">plugin_name</span>
        <span class="n">hook_name</span> <span class="o">=</span> <span class="s1">&#39;`napari_experimental_provide_theme`&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>
            <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provided a non-dict object to </span><span class="si">{hook_name!r}</span><span class="s1">: data ignored&#39;</span><span class="p">,</span>
                <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">theme_name</span><span class="p">,</span> <span class="n">theme_colors</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">theme</span> <span class="o">=</span> <span class="n">Theme</span><span class="o">.</span><span class="n">parse_obj</span><span class="p">(</span><span class="n">theme_colors</span><span class="p">)</span>
                <span class="n">register_theme</span><span class="p">(</span><span class="n">theme_name</span><span class="p">,</span> <span class="n">theme</span><span class="p">)</span>
                <span class="n">_data</span><span class="p">[</span><span class="n">theme_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">theme</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">warn_msg</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s2">&quot;In </span><span class="si">{hook_name!r}</span><span class="s2">, plugin </span><span class="si">{plugin_name!r}</span><span class="s2"> provided an invalid dict object for creating themes. </span><span class="si">{err!r}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">err</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_msg</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="NapariPluginManager.unregister_theme_colors"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.unregister_theme_colors">[docs]</a>    <span class="k">def</span> <span class="nf">unregister_theme_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unregister theme data from napari.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># unregister all themes that were provided by the plugins</span>
        <span class="k">for</span> <span class="n">theme_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]:</span>
            <span class="n">unregister_theme</span><span class="p">(</span><span class="n">theme_name</span><span class="p">)</span>

        <span class="c1"># since its possible that disabled/removed plugin was providing the</span>
        <span class="c1"># current theme, we check for this explicitly and if this the case,</span>
        <span class="c1"># theme is automatically changed to default `dark` theme</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">()</span>
        <span class="n">current_theme</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">appearance</span><span class="o">.</span><span class="n">theme</span>
        <span class="k">if</span> <span class="n">current_theme</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">appearance</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="s2">&quot;dark&quot;</span>  <span class="c1"># type: ignore</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s2">&quot;The current theme </span><span class="si">{current_theme!r}</span><span class="s2"> was provided by the plugin </span><span class="si">{plugin_name!r}</span><span class="s2"> which was disabled or removed. Switched theme to the default.&quot;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">current_theme</span><span class="o">=</span><span class="n">current_theme</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="NapariPluginManager.discover_themes"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.discover_themes">[docs]</a>    <span class="k">def</span> <span class="nf">discover_themes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Trigger discovery of theme plugins.</span>

<span class="sd">        As a &quot;historic&quot; hook, this should only need to be called once.</span>
<span class="sd">        (historic here means that even plugins that are discovered after this</span>
<span class="sd">        is called will be added.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theme_data</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">napari_experimental_provide_theme</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span>
            <span class="n">result_callback</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">register_theme_colors</span><span class="p">),</span> <span class="n">with_impl</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>

    <span class="c1"># FUNCTION &amp; DOCK WIDGETS -----------------------</span>

    <span class="k">def</span> <span class="nf">iter_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]:</span>
        <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">repeat</span>

        <span class="n">dock_widgets</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">repeat</span><span class="p">(</span><span class="s2">&quot;dock&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">func_widgets</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">repeat</span><span class="p">(</span><span class="s2">&quot;func&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function_widgets</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">yield from</span> <span class="n">chain</span><span class="p">(</span><span class="n">dock_widgets</span><span class="p">,</span> <span class="n">func_widgets</span><span class="p">)</span>  <span class="c1"># type: ignore [misc]</span>

    <span class="k">def</span> <span class="nf">register_dock_widget</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AugmentedWidget</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">AugmentedWidget</span><span class="p">]],</span>
        <span class="n">hookimpl</span><span class="p">:</span> <span class="n">HookImplementation</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">plugin_name</span> <span class="o">=</span> <span class="n">hookimpl</span><span class="o">.</span><span class="n">plugin_name</span>
        <span class="n">hook_name</span> <span class="o">=</span> <span class="s1">&#39;`napari_experimental_provide_dock_widget`&#39;</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">args</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">arg</span><span class="p">:</span>
                    <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                        <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provided an invalid tuple to </span><span class="si">{hook_name}</span><span class="s1">.  Skipping&#39;</span><span class="p">,</span>
                        <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                        <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">_cls</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_cls</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">{})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">_cls</span><span class="p">):</span>
                <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provided a non-callable object (widget) to </span><span class="si">{hook_name}</span><span class="s1">: </span><span class="si">{_cls!r}</span><span class="s1">. Widget ignored.&#39;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
                    <span class="n">_cls</span><span class="o">=</span><span class="n">_cls</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>

                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provided invalid kwargs to </span><span class="si">{hook_name}</span><span class="s1"> for class </span><span class="si">{clsname}</span><span class="s1">. Widget ignored.&#39;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
                    <span class="n">clsname</span><span class="o">=</span><span class="n">_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Get widget name</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">camel_to_spaces</span><span class="p">(</span>
                <span class="n">_cls</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="p">:</span>
                <span class="c1"># tried defaultdict(dict) but got odd KeyErrors...</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]:</span>
                <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> has already registered a dock widget </span><span class="si">{name!r}</span><span class="s1"> which has now been overwritten&#39;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_cls</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register_function_widget</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]],</span>
        <span class="n">hookimpl</span><span class="p">:</span> <span class="n">HookImplementation</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">plugin_name</span> <span class="o">=</span> <span class="n">hookimpl</span><span class="o">.</span><span class="n">plugin_name</span>
        <span class="n">hook_name</span> <span class="o">=</span> <span class="s1">&#39;`napari_experimental_provide_function`&#39;</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">args</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">FunctionType</span><span class="p">):</span>
                <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provided a non-callable type to </span><span class="si">{hook_name}</span><span class="s1">: </span><span class="si">{functype!r}</span><span class="s1">. Function widget ignored.&#39;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">functype</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">hook_name</span><span class="o">=</span><span class="n">hook_name</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">warn_message</span> <span class="o">+=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                        <span class="s2">&quot; To provide multiple function widgets please use a LIST of callables&quot;</span><span class="p">,</span>
                        <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Get function name</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function_widgets</span><span class="p">:</span>
                <span class="c1"># tried defaultdict(dict) but got odd KeyErrors...</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_function_widgets</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function_widgets</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]:</span>
                <span class="n">warn_message</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> has already registered a function widget </span><span class="si">{name!r}</span><span class="s1"> which has now been overwritten&#39;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">warn_message</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_function_widgets</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">discover_sample_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_data</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">napari_provide_sample_data</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span>
            <span class="n">result_callback</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">register_sample_data</span><span class="p">),</span> <span class="n">with_impl</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

<div class="viewcode-block" id="NapariPluginManager.discover_widgets"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.discover_widgets">[docs]</a>    <span class="k">def</span> <span class="nf">discover_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Trigger discovery of dock_widgets plugins.</span>

<span class="sd">        As a &quot;historic&quot; hook, this should only need to be called once.</span>
<span class="sd">        (historic here means that even plugins that are discovered after this</span>
<span class="sd">        is called will be added.)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">napari_experimental_provide_dock_widget</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">register_dock_widget</span><span class="p">),</span> <span class="n">with_impl</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">napari_experimental_provide_function</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">register_function_widget</span><span class="p">),</span> <span class="n">with_impl</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="NapariPluginManager.get_widget"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.get_widget">[docs]</a>    <span class="k">def</span> <span class="nf">get_widget</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">widget_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">WidgetCallable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get widget `widget_name` provided by plugin `plugin_name`.</span>

<span class="sd">        Note: it&#39;s important that :func:`discover_dock_widgets` has been called</span>
<span class="sd">        first, otherwise plugins may not be found yet.  (Typically, that is done</span>
<span class="sd">        in qt_main_window)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plugin_name : str</span>
<span class="sd">            Name of a plugin providing a widget</span>
<span class="sd">        widget_name : str, optional</span>
<span class="sd">            Name of a widget provided by `plugin_name`. If `None`, and the</span>
<span class="sd">            specified plugin provides only a single widget, that widget will be</span>
<span class="sd">            returned, otherwise a ValueError will be raised, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plugin_widget : Tuple[Callable, dict]</span>
<span class="sd">            Tuple of (widget_class, options).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If plugin `plugin_name` does not provide any widgets</span>
<span class="sd">        KeyError</span>
<span class="sd">            If plugin does not provide a widget named `widget_name`.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If `widget_name` is not provided, but `plugin_name` provides more than</span>
<span class="sd">            one widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plg_wdgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widgets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plg_wdgs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> does not provide any dock widgets&#39;</span><span class="p">,</span>
                <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">widget_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plg_wdgs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> provides more than 1 dock_widget. Must also provide &quot;widget_name&quot; from </span><span class="si">{avail}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">avail</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">plg_wdgs</span><span class="p">),</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">widget_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plg_wdgs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">widget_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plg_wdgs</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;Plugin </span><span class="si">{plugin_name!r}</span><span class="s1"> does not provide a widget named </span><span class="si">{widget_name!r}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">plugin_name</span><span class="o">=</span><span class="n">plugin_name</span><span class="p">,</span>
                    <span class="n">widget_name</span><span class="o">=</span><span class="n">widget_name</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plg_wdgs</span><span class="p">[</span><span class="n">widget_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="NapariPluginManager.get_reader_for_extension"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.get_reader_for_extension">[docs]</a>    <span class="k">def</span> <span class="nf">get_reader_for_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return reader plugin assigned to `extension`, or None.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_plugin_for_extension</span><span class="p">(</span><span class="n">extension</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;reader&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NapariPluginManager.assign_reader_to_extensions"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.assign_reader_to_extensions">[docs]</a>    <span class="k">def</span> <span class="nf">assign_reader_to_extensions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extensions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Assign a specific reader plugin to `extensions`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reader : str</span>
<span class="sd">            Name of a plugin offering a reader hook.</span>
<span class="sd">        extensions : Union[str, Iterable[str]]</span>
<span class="sd">            Name(s) of extensions to always write with `reader`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..settings</span> <span class="kn">import</span> <span class="n">get_settings</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_plugin_to_extensions</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">extensions</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;reader&#39;</span><span class="p">)</span>
        <span class="n">extension2readers</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">()</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">extension2reader</span>
        <span class="n">get_settings</span><span class="p">()</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">extension2reader</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="n">extension2readers</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_extension2reader</span><span class="p">,</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="NapariPluginManager.get_writer_for_extension"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.get_writer_for_extension">[docs]</a>    <span class="k">def</span> <span class="nf">get_writer_for_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return writer plugin assigned to `extension`, or None.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_plugin_for_extension</span><span class="p">(</span><span class="n">extension</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;writer&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NapariPluginManager.assign_writer_to_extensions"><a class="viewcode-back" href="../../../api/napari.plugins.NapariPluginManager.html#napari.plugins.NapariPluginManager.assign_writer_to_extensions">[docs]</a>    <span class="k">def</span> <span class="nf">assign_writer_to_extensions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extensions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Assign a specific writer plugin to `extensions`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        writer : str</span>
<span class="sd">            Name of a plugin offering a writer hook.</span>
<span class="sd">        extensions : Union[str, Iterable[str]]</span>
<span class="sd">            Name(s) of extensions to always write with `writer`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..settings</span> <span class="kn">import</span> <span class="n">get_settings</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_plugin_to_extensions</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">extensions</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;writer&#39;</span><span class="p">)</span>
        <span class="n">get_settings</span><span class="p">()</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">extension2writer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extension2writer</span></div>

    <span class="k">def</span> <span class="nf">_get_plugin_for_extension</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;helper method for public get_&lt;type_&gt;_for_extension functions.&quot;&quot;&quot;</span>
        <span class="n">ext_map</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_extension2</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s2">&quot;invalid plugin type: </span><span class="si">{type_!r}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">type_</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">extension</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">ext_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
        <span class="c1"># make sure it&#39;s still an active plugin</span>
        <span class="k">if</span> <span class="n">plugin</span> <span class="ow">and</span> <span class="p">(</span><span class="n">plugin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_map</span><span class="p">[</span><span class="n">plugin</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">plugin</span>

    <span class="k">def</span> <span class="nf">_assign_plugin_to_extensions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">plugin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">extensions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">type_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;helper method for public assign_&lt;type_&gt;_to_extensions functions.&quot;&quot;&quot;</span>
        <span class="n">caller</span><span class="p">:</span> <span class="n">HookCaller</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;napari_get_</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">caller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s2">&quot;invalid plugin type: </span><span class="si">{type_!r}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">type_</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">plugins</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">get_hookimpls</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">plugin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">plugin_name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">}:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{plugin!r}</span><span class="s2"> is not a valid </span><span class="si">{type_}</span><span class="s2"> plugin name&quot;</span><span class="p">,</span>
                <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                <span class="n">type_</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span>
                <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">ext_map</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_extension2</span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extensions</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">extensions</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">ext_map</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin</span>

            <span class="c1"># give warning that plugin *may* not be able to read that extension</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">_call_plugin</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;_testing_</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">_</span><span class="p">(</span>
                    <span class="s1">&#39;plugin </span><span class="si">{plugin!r}</span><span class="s1"> did not return a </span><span class="si">{type_}</span><span class="s1"> function when provided a path ending in </span><span class="si">{ext!r}</span><span class="s1">. This *may* indicate a typo?&#39;</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                    <span class="n">type_</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span>
                    <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, The napari team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>