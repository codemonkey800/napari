
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing &#8212; napari</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Organization of Documentation for napari" href="docs.html" />
    <link rel="prev" title="Release guide" href="release.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.png" class="logo" alt="logo">
</a>


    
    <!-- A small template snippet for theme testing -->
<b>napari</b>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../usage.html">
  Usage
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../plugins/index.html">
  Plugins
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../community/index.html">
  Community
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/index.html">
  API Reference
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://napari-hub.org">napari hub<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/napari/napari" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../community/mission_and_values.html">
   Mission and Values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../community/team.html">
   About the project and team
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../community/code_of_conduct.html">
   Code of Conduct
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../community/code_of_conduct_reporting.html">
   Handling Code of Conduct reports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../community/governance.html">
   Governance model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../community/working_groups.html">
   Working groups
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../community/meeting_schedule.html">
   Meeting schedule
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Contributing resources
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="benchmarks.html">
     Benchmarks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="contributing.html">
     Contributing guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="core_dev_guide.html">
     Core Developer guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="profiling.html">
     Profiling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="release.html">
     Release guide
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="docs.html">
     Organization of Documentation for napari
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="translations.html">
     Translations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../release/index.html">
   Release notes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_14.html">
     napari 0.4.14
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_13.html">
     napari 0.4.13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_12.html">
     napari 0.4.12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_11.html">
     napari 0.4.11
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_10.html">
     napari 0.4.10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_9.html">
     napari 0.4.9
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_8.html">
     napari 0.4.8
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_7.html">
     napari 0.4.7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_6.html">
     napari 0.4.6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_5.html">
     napari 0.4.5
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_4.html">
     napari 0.4.4
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_3.html">
     napari 0.4.3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_2.html">
     napari 0.4.2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_1.html">
     napari 0.4.1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_4_0.html">
     napari 0.4.0
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_8.html">
     napari 0.3.8
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_7.html">
     napari 0.3.7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_6.html">
     napari 0.3.6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_5.html">
     napari 0.3.5
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_4.html">
     napari 0.3.4
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_3.html">
     napari 0.3.3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_2.html">
     napari 0.3.2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_1.html">
     napari 0.3.1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_3_0.html">
     napari 0.3.0
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_12.html">
     napari 0.2.12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_11.html">
     napari 0.2.11
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_10.html">
     napari 0.2.10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_9.html">
     napari 0.2.9
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_8.html">
     napari 0.2.8
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_7.html">
     napari 0.2.7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_6.html">
     napari 0.2.6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_5.html">
     napari 0.2.5
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_4.html">
     napari 0.2.4
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_3.html">
     napari 0.2.3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_1.html">
     napari 0.2.1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_2_0.html">
     napari 0.2.0
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_1_5.html">
     napari 0.1.5
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_1_3.html">
     napari 0.1.3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../release/release_0_1_0.html">
     napari 0.1.0
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../roadmaps/index.html">
   Roadmaps
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../roadmaps/0_4.html">
     Roadmap 0.4
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../roadmaps/0_3_retrospective.html">
     Roadmap 0.3 Retrospective
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../roadmaps/0_3.html">
     Roadmap 0.3
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-organization">
   Test organization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-tests">
   Running tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tips-for-speeding-up-local-testing">
     Tips for speeding up local testing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-coverage-locally">
     Testing coverage locally
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-tests">
   Writing tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#property-based-testing-with-hypothesis">
     Property-based testing with Hypothesis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-with-qt-and-napari-viewer">
     Testing with
     <code class="docutils literal notranslate">
      <span class="pre">
       Qt
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       napari.Viewer
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mocking-fake-it-till-you-make-it">
     Mocking: “Fake it till you make it”
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#known-issues">
   Known issues
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="testing">
<span id="napari-testing"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>We use unit tests, integration tests, and functional tests to ensure that
<code class="docutils literal notranslate"><span class="pre">napari</span></code> works as intended. We have</p>
<ul class="simple">
<li><p>Unit tests which test if individual modules or functions work correctly
in isolation.</p></li>
<li><p>Integration tests which test if different modules or functions work properly
when combined.</p></li>
<li><p>Functional tests which test if slices of <code class="docutils literal notranslate"><span class="pre">napari</span></code> functionality work as
intended in the whole system.</p></li>
</ul>
<p>To get the most return on investment (ROI) from our coding, we strive to test as
much as we can with unit tests, requiring fewer integration tests, and the least number
of functional tests as depicted in the test pyramid below from
<a class="reference external" href="https://www.softwaretestinghelp.com/the-difference-between-unit-integration-and-functional-testing/">softwaretestinghelp.com</a>:</p>
<p><img alt="tests" src="../_images/tests.png" /></p>
<p>Unit tests are at the base of the pyramid because they are the easiest to write and
the quickest to run. The time and effort to implement and maintain tests increases
from unit tests to integration and functional tests.</p>
</div>
<div class="section" id="test-organization">
<h2>Test organization<a class="headerlink" href="#test-organization" title="Permalink to this headline">¶</a></h2>
<p>All of <code class="docutils literal notranslate"><span class="pre">napari</span></code> tests are located in folders named <code class="docutils literal notranslate"><span class="pre">_tests</span></code>. We keep our unit
tests located in the individual folders with the modules or functions they are
testing (e.g. the tests for the <code class="docutils literal notranslate"><span class="pre">Image</span></code> layer are located in a <code class="docutils literal notranslate"><span class="pre">_tests</span></code> folder
alongside the <code class="docutils literal notranslate"><span class="pre">image.py</span></code> file). Our integration and functional tests are located in
the <code class="docutils literal notranslate"><span class="pre">napari/_tests</span></code> folder at the top of the repository.</p>
<p>We also strive to unit test as much of our model file and utils code independently of
our GUI code. These tests are located in the <code class="docutils literal notranslate"><span class="pre">napari/layers</span></code>, <code class="docutils literal notranslate"><span class="pre">napari/components</span></code>,
and <code class="docutils literal notranslate"><span class="pre">napari/utils</span></code> folders. Our GUI code is tests in the <code class="docutils literal notranslate"><span class="pre">napari/_tests</span></code>,
<code class="docutils literal notranslate"><span class="pre">napari/_qt</span></code>, <code class="docutils literal notranslate"><span class="pre">napari/_vispy</span></code> folders. The <code class="docutils literal notranslate"><span class="pre">napari/plugins</span></code> folder contains a mix
of tests.</p>
</div>
<div class="section" id="running-tests">
<h2>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>To run our test suite locally, run <code class="docutils literal notranslate"><span class="pre">pytest</span></code> on the command line.  If, for some reason
you don’t already have the test requirements in your environment, run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.[testing]</span></code>.</p>
<p>There are a very small number of tests (&lt;5) that require showing GUI elements, (such
as testing screenshots). By default, these are only run during continuous integration.
If you’d like to include them in local tests, set the environment variable “CI”:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">CI</span><span class="o">=</span><span class="m">1</span> pytest
</pre></div>
</div>
<div class="section" id="tips-for-speeding-up-local-testing">
<h3>Tips for speeding up local testing<a class="headerlink" href="#tips-for-speeding-up-local-testing" title="Permalink to this headline">¶</a></h3>
<p>Very often when developing new code, you don’t need or want to run the entire test suite (which can take many minutes to finish).  With <code class="docutils literal notranslate"><span class="pre">pytest</span></code>, it’s easy to run a subset of your tests:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># run tests in a specific subdirectory</span>
pytest napari/components
<span class="c1"># run tests in a specific file</span>
pytest napari/components/_tests/test_add_layers.py
<span class="c1"># run a specific test within a specific file</span>
pytest napari/components/_tests/test_add_layers.py::test_add_layers_with_plugins
<span class="c1"># select tests based on substring match of test name:</span>
pytest napari/layers/ -k <span class="s1">&#39;points and not bindings&#39;</span>
</pre></div>
</div>
<p>In general, it pays to learn a few of the <a class="reference external" href="https://docs.pytest.org/en/latest/example/index.html">tips and tricks</a> of running pytest.</p>
</div>
<div class="section" id="testing-coverage-locally">
<h3>Testing coverage locally<a class="headerlink" href="#testing-coverage-locally" title="Permalink to this headline">¶</a></h3>
<p>We always aim for good <a class="reference external" href="https://en.wikipedia.org/wiki/Code_coverage">test coverage</a> and we use <a class="reference external" href="https://codecov.io/gh/napari/napari">codecov</a> during continuous integration to make sure we maintain good coverage.  If you’d like to test coverage locally as you develop new code, you can install <a class="reference external" href="https://github.com/pytest-dev/pytest-cov"><code class="docutils literal notranslate"><span class="pre">pytest-cov</span></code></a> and take advantage of a few handy commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># run the full test suite with coverage</span>
pytest --cov<span class="o">=</span>napari
<span class="c1"># instead of coverage in the console, get a nice browser-based cov-report</span>
pytest --cov<span class="o">=</span>napari --cov-report<span class="o">=</span>html
open htmlcov/index.html  <span class="c1"># look at the report</span>
<span class="c1"># run a subset of tests with coverage</span>
pytest --cov<span class="o">=</span>napari.layers.shapes --cov-report<span class="o">=</span>html napari/layers/shapes
open htmlcov/index.html  <span class="c1"># look at the report</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="writing-tests">
<h2>Writing tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h2>
<p>Writing tests for new code is a critical part of keeping napari maintainable as
it grows. Tests are written in files whose names
begin with <code class="docutils literal notranslate"><span class="pre">test_*</span></code> and which are contained in one of the <code class="docutils literal notranslate"><span class="pre">_tests</span></code> directories.</p>
<div class="section" id="property-based-testing-with-hypothesis">
<h3>Property-based testing with Hypothesis<a class="headerlink" href="#property-based-testing-with-hypothesis" title="Permalink to this headline">¶</a></h3>
<p>Property-based tests allow you to test that “for any X, …” - with a much nicer
developer experience than using truly random data.  We use Hypothesis for unit or
integration tests where there are simple properties like <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">==</span> <span class="pre">load(save(x))</span></code> or
when Napari implements a function we can check against the equivalent in a trusted
library for at least some inputs.</p>
<p>See also <a class="reference external" href="http://conference.scipy.org/proceedings/scipy2020/zac_hatfield-dodds.html">this paper on property-based testing in science</a>,
<a class="reference external" href="https://github.com/napari/napari/issues/2444">issue #2444</a>, and
<a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/">the Hypothesis documentation</a>
(including <a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/numpy.html">Numpy support</a>).</p>
</div>
<div class="section" id="testing-with-qt-and-napari-viewer">
<h3>Testing with <code class="docutils literal notranslate"><span class="pre">Qt</span></code> and <code class="docutils literal notranslate"><span class="pre">napari.Viewer</span></code><a class="headerlink" href="#testing-with-qt-and-napari-viewer" title="Permalink to this headline">¶</a></h3>
<p>There are a couple things to keep in mind when writing a test where a <code class="docutils literal notranslate"><span class="pre">Qt</span></code> event
loop or a <code class="docutils literal notranslate"><span class="pre">napari.Viewer</span></code> is required.  The important thing is that any widgets
you create during testing are cleaned up at the end of each test:</p>
<ol>
<li><p>If you need a <code class="docutils literal notranslate"><span class="pre">QApplication</span></code> to be running for your test, you can use the
<a class="reference external" href="https://pytest-qt.readthedocs.io/en/latest/reference.html#pytestqt.qtbot.QtBot"><code class="docutils literal notranslate"><span class="pre">qtbot</span></code></a> fixture from <code class="docutils literal notranslate"><span class="pre">pytest-qt</span></code></p>
<blockquote>
<div><p>note: fixtures in pytest can be a little mysterious, since it’s not always
clear where they are coming from.  In this case, using a pytest-qt fixture
looks like this:</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># just by putting `qtbot` in the list of arguments</span>
<span class="c1"># pytest-qt will start up an event loop for you</span>
<span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="n">qtbot</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">qtbot</span></code> provides a convenient
<a class="reference external" href="https://pytest-qt.readthedocs.io/en/latest/reference.html#pytestqt.qtbot.QtBot.addWidget"><code class="docutils literal notranslate"><span class="pre">addWidget</span></code></a>
method that will ensure that the widget gets closed at the end of the test.
It <em>also</em> provides a whole bunch of other
convenient methods for interacting with your GUI tests (clicking, waiting
signals, etc…).  See the <a class="reference external" href="https://pytest-qt.readthedocs.io/en/latest/reference.html#pytestqt.qtbot.QtBot"><code class="docutils literal notranslate"><span class="pre">qtbot</span></code> docs</a> for details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># the qtbot provides convenience methods like addWidget</span>
<span class="k">def</span> <span class="nf">test_something_else</span><span class="p">(</span><span class="n">qtbot</span><span class="p">):</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
    <span class="n">qtbot</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>  <span class="c1"># tell qtbot to clean this widget later</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>When writing a test that requires a <code class="docutils literal notranslate"><span class="pre">napari.Viewer</span></code> object, we provide a
<a class="reference external" href="https://docs.pytest.org/en/stable/fixture.html">pytest fixture</a> called
<code class="docutils literal notranslate"><span class="pre">make_napari_viewer</span></code> that will take care of creating a viewer and cleaning up
at the end of the test.  When using this function, it is <strong>not</strong> necessary to
use a <code class="docutils literal notranslate"><span class="pre">qtbot</span></code> fixture, nor should you do any additional cleanup (such as
using <code class="docutils literal notranslate"><span class="pre">qtbot.addWidget</span></code> or calling <code class="docutils literal notranslate"><span class="pre">viewer.close()</span></code>) at the end of the test.
Duplicate cleanup may cause an error.  Use the fixture as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># the make_napari_viewer fixture is defined in napari/conftest.py</span>
<span class="k">def</span> <span class="nf">test_something_with_a_viewer</span><span class="p">(</span><span class="n">make_napari_viewer</span><span class="p">):</span>
    <span class="c1"># make_napari_viewer takes any keyword arguments that napari.Viewer() takes</span>
    <span class="n">viewer</span> <span class="o">=</span> <span class="n">make_napari_viewer</span><span class="p">()</span>

    <span class="c1"># do stuff with the viewer, no qtbot or viewer.close() methods needed.</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>If you’re curious to see the actual <code class="docutils literal notranslate"><span class="pre">make_napari_viewer</span></code> fixture definition, it’s
in <code class="docutils literal notranslate"><span class="pre">napari/conftest.py</span></code></p>
</div></blockquote>
</div>
<div class="section" id="mocking-fake-it-till-you-make-it">
<h3>Mocking: “Fake it till you make it”<a class="headerlink" href="#mocking-fake-it-till-you-make-it" title="Permalink to this headline">¶</a></h3>
<p>It can be confusing to write unit tests for individual functions, when the
function being tested in turn depends on the output from some other function or
method.  This makes it tempting to write integration tests that “just test the
whole thing together”.  A useful tool in this case is the <a class="reference external" href="https://docs.python.org/3/library/unittest.mock.html">mock object
library</a>.  “Mocking” lets
you patch or replace parts of the code being tested with “fake” behavior or
return values, so that you can test how a given function would perform <em>if</em> it
were to receive some value from the upstream code.  For a few examples of using
mocks when testing napari, search the codebase for
<a class="reference external" href="https://github.com/napari/napari/search?q=%22unittest.mock%22&amp;type=Code"><code class="docutils literal notranslate"><span class="pre">unittest.mock</span></code></a></p>
</div>
</div>
<div class="section" id="known-issues">
<h2>Known issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<p>There are several known issues with displaying GUI tests on windows in CI, and
so certain tests have been disabled from windows in CI, see
<a class="reference external" href="https://github.com/napari/napari/pull/1377">#1377</a> for more discussion.</p>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="release.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Release guide</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="docs.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Organization of Documentation for napari</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, The napari team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>