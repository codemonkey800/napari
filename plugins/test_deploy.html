
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test and Deploy &#8212; napari</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Best practices" href="best_practices.html" />
    <link rel="prev" title="Contribution Guides" href="guides.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.png" class="logo" alt="logo">
</a>


    
    <!-- A small template snippet for theme testing -->
<b>napari</b>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../usage.html">
  Usage
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Plugins
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../community/index.html">
  Community
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/index.html">
  API Reference
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://napari-hub.org">napari hub<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/napari/napari" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="find_and_install_plugin.html">
   Finding and installing a napari plugin
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="first_plugin.html">
   Your First Plugin
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="manifest.html">
   Manifest Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="contributions.html">
   Contributions Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="guides.html">
   Contribution Guides
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Test and Deploy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="best_practices.html">
   Best practices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="npe2_migration_guide.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     npe2
    </span>
   </code>
   migration guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="npe1.html">
   1st Gen Plugin Guide (
   <em>
    Deprecated
   </em>
   )
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tips-for-testing-napari-plugins">
   Tips for testing napari plugins
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-make-napari-viewer-fixture">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       make_napari_viewer
      </span>
     </code>
     fixture
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prefer-smaller-unit-tests-when-possible">
     Prefer smaller unit tests when possible
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-for-release">
   Preparing for release
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deployment">
   Deployment
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="test-and-deploy">
<span id="plugin-test-deploy"></span><h1>Test and Deploy<a class="headerlink" href="#test-and-deploy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tips-for-testing-napari-plugins">
<span id="plugin-testing-tips"></span><h2>Tips for testing napari plugins<a class="headerlink" href="#tips-for-testing-napari-plugins" title="Permalink to this headline">¶</a></h2>
<p>Testing is a big topic!  If you are completely new to writing tests in python,
consider reading this post on <a class="reference external" href="https://realpython.com/python-testing/">Getting Started With Testing in
Python</a></p>
<p>We recommend using
<a class="reference external" href="https://docs.pytest.org/en/6.2.x/getting-started.html">pytest</a> for testing your
plugin. Aim for <a class="reference external" href="best_practices.html#how-to-check-test-coverage">100% test coverage</a>!</p>
<div class="section" id="the-make-napari-viewer-fixture">
<h3>The <code class="docutils literal notranslate"><span class="pre">make_napari_viewer</span></code> fixture<a class="headerlink" href="#the-make-napari-viewer-fixture" title="Permalink to this headline">¶</a></h3>
<p>Testing a napari <code class="docutils literal notranslate"><span class="pre">Viewer</span></code> requires some setup and teardown each time.  We have
created a <a class="reference external" href="https://docs.pytest.org/en/6.2.x/fixture.html">pytest fixture</a> called
<code class="docutils literal notranslate"><span class="pre">make_napari_viewer</span></code> that you can use (this requires that you have napari
installed in your environment).</p>
<p>To use a fixture in pytest, you simply include the name of the fixture in the
test parameters (oddly enough, you don’t need to import it!).  For example, to
create a napari viewer for testing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_something_with_a_viewer</span><span class="p">(</span><span class="n">make_napari_viewer</span><span class="p">):</span>
    <span class="n">viewer</span> <span class="o">=</span> <span class="n">make_napari_viewer</span><span class="p">()</span>
    <span class="o">...</span>  <span class="c1"># carry on with your test</span>
</pre></div>
</div>
</div>
<div class="section" id="prefer-smaller-unit-tests-when-possible">
<h3>Prefer smaller unit tests when possible<a class="headerlink" href="#prefer-smaller-unit-tests-when-possible" title="Permalink to this headline">¶</a></h3>
<p>The most common issue people run into when designing tests for napari plugins is
that they try to test everything as a full “integration test”, starting from the
napari event or action that would trigger their plugin to do something.  For
example, let’s say you have a dock widget that connects a mouse callback to the
viewer:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyWidget</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">:</span> <span class="s1">&#39;napari.Viewer&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="o">=</span> <span class="n">viewer</span>

        <span class="nd">@viewer</span><span class="o">.</span><span class="n">mouse_move_callbacks</span><span class="o">.</span><span class="n">append</span>
        <span class="k">def</span> <span class="nf">_on_mouse_move</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;Shift&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
                <span class="o">...</span>

<span class="nd">@napari_hook_implementation</span>
<span class="k">def</span> <span class="nf">napari_experimental_provide_dock_widget</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">MyWidget</span>
</pre></div>
</div>
<p>You might think that you need to somehow simulate a mouse movement in napari in
order to test this, but you don’t! Just <em>trust</em> that napari will call this
function with a <code class="docutils literal notranslate"><span class="pre">Viewer</span></code> and an <code class="docutils literal notranslate"><span class="pre">Event</span></code> when a mouse move has been made, and
otherwise leave <code class="docutils literal notranslate"><span class="pre">napari</span></code> out of it.</p>
<p>Instead, focus on “unit testing” your code: just call the function directly with
objects that emulate, or “mock” the objects that your function expects to
receive from napari. You may also need to slightly reorganize your code.  Let’s
modify the above widget to make it easier to test:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyWidget</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">:</span> <span class="s1">&#39;napari.Viewer&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="o">=</span> <span class="n">viewer</span>
        <span class="c1"># connecting to a method rather than a local function</span>
        <span class="c1"># makes it easier to test</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">mouse_move_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_mouse_move</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Shift&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>To test this, we can often just instantiate the widget with our own viewer, and
then call the methods directly. As for the <code class="docutils literal notranslate"><span class="pre">event</span></code> object, notice that all we
care about in this plugin is that it has a <code class="docutils literal notranslate"><span class="pre">modifiers</span></code> attribute that may or may
not contain the string <code class="docutils literal notranslate"><span class="pre">&quot;Shift&quot;</span></code>.  So let’s just fake it!</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FakeEvent</span><span class="p">:</span>
    <span class="n">modifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Shift&#39;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_mouse_callback</span><span class="p">(</span><span class="n">make_napari_viewer</span><span class="p">):</span>
    <span class="n">viewer</span> <span class="o">=</span> <span class="n">make_napari_viewer</span><span class="p">()</span>
    <span class="n">wdg</span> <span class="o">=</span> <span class="n">MyWidget</span><span class="p">(</span><span class="n">viewer</span><span class="p">)</span>
    <span class="n">wdg</span><span class="o">.</span><span class="n">_on_mouse_move</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">FakeEvent</span><span class="p">())</span>
    <span class="c1"># assert that what you expect to happen actually happened!</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="preparing-for-release">
<h2>Preparing for release<a class="headerlink" href="#preparing-for-release" title="Permalink to this headline">¶</a></h2>
<p>To help users find your plugin, make sure to use the <code class="docutils literal notranslate"><span class="pre">Framework</span> <span class="pre">::</span> <span class="pre">napari</span></code>
<a class="reference external" href="https://pypi.org/classifiers/">classifier</a> in your package’s core metadata. (If you used the cookiecutter,
this has already been done for you.)</p>
<p>Once your package is listed on <a class="reference external" href="https://pypi.org/">PyPI</a> (and includes the <code class="docutils literal notranslate"><span class="pre">Framework</span> <span class="pre">::</span> <span class="pre">napari</span></code>
<a class="reference external" href="https://pypi.org/classifiers/">classifier</a>), it will also be visible on the <a class="reference external" href="https://napari-hub.org/">napari
hub</a>. To ensure you are providing the relevant metadata and
description for your plugin, see the following documentation in the <a class="reference external" href="https://github.com/chanzuckerberg/napari-hub/tree/main/docs">napari hub
GitHub</a>’s docs
folder:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/chanzuckerberg/napari-hub/blob/main/docs/customizing-plugin-listing.md">Customizing your plugin’s
listing</a></p></li>
<li><p><a class="reference external" href="https://github.com/chanzuckerberg/napari-hub/blob/main/docs/writing-the-perfect-description.md">Writing the perfect description for your
plugin</a></p></li>
</ul>
<div class="admonition-the-hub admonition">
<p class="admonition-title">The hub</p>
<p>For more about the napari hub, see the <a class="reference external" href="https://www.napari-hub.org/about">napari hub About
page</a>. To learn more about the hub’s
development process, see the <a class="reference external" href="https://github.com/chanzuckerberg/napari-hub/wiki">napari hub GitHub’s
Wiki</a>.</p>
<p>If you want your plugin to be available on PyPI, but not visible on the napari
hub, you can add a <code class="docutils literal notranslate"><span class="pre">.napari/config.yml</span></code> file to the root of your repository with
a visibility key. For details, see the <a class="reference external" href="https://github.com/chanzuckerberg/napari-hub/blob/main/docs/customizing-plugin-listing.md#visibility">customization
guide</a>.</p>
</div>
<p>Finally, once you have curated your package metadata and description, you can
preview your metadata, and check any missing fields using the
napari hub preview page service. Check out <a class="reference external" href="https://github.com/chanzuckerberg/napari-hub/blob/main/docs/setting-up-preview.md">this guide</a> for instructions on how to set it up.</p>
</div>
<div class="section" id="deployment">
<h2>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h2>
<p>When you are ready to share your plugin, <a class="reference external" href="https://packaging.python.org/tutorials/packaging-projects/#uploading-the-distribution-archives">upload the Python package to
PyPI</a> after which it will be installable using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">&lt;yourpackage&gt;</span></code>, or (assuming you added the <code class="docutils literal notranslate"><span class="pre">Framework</span> <span class="pre">::</span> <span class="pre">napari</span></code> classifier)
in the builtin plugin installer dialog.</p>
<p>If you used the <a class="reference internal" href="npe1.html#plugin-cookiecutter-template"><span class="std std-ref">Cookiecutter template</span></a>, you can also
<a class="reference external" href="https://github.com/napari/cookiecutter-napari-plugin#set-up-automatic-deployments">setup automated deployments</a> on github for every tagged commit.</p>
<div class="admonition-what-about-conda admonition">
<p class="admonition-title">What about conda?</p>
<p>While you are free to distribute your plugin on anaconda cloud in addition to
or instead of PyPI, the built-in napari plugin installer doesn’t currently install
from conda. In this case, you may guide your users to install your package on the
command line using conda in your readme or documentation.</p>
<p>A future version of napari and the napari stand-alone application may support
directly installing from conda.</p>
</div>
<p>When you are ready for users, announce your plugin on the <a class="reference external" href="https://forum.image.sc/tag/napari">Image.sc
forum</a>.</p>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="guides.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Contribution Guides</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="best_practices.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Best practices</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, The napari team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>